import React, { useState } from 'react';
import VisibilitySensor from 'react-visibility-sensor';
import './statistics.css'; 
import photo from '../../images/statistics.jpg';

const Statistics = () => {
  const [counts, setCounts] = useState({
    positions: 0,
    orders: 0,
    clients: 0
  });

  const handleVisibilityChange = (isVisible) => {
    if (isVisible) {
      animateCounts();
    }
  };

  const animateCounts = () => {
    const targetCounts = {
      positions: 150,
      orders: 13000,
      clients: 28000
    };

    Object.keys(targetCounts).forEach((key) => {
      let currentCount = 0;
      const interval = setInterval(() => {
        currentCount += Math.ceil((targetCounts[key] - currentCount) / 12);
        if (currentCount >= targetCounts[key]) {
          clearInterval(interval);
          currentCount = targetCounts[key];
        }
        setCounts((prevCounts) => ({ ...prevCounts, [key]: currentCount }));
      }, 20);
    });
  };

  return (
    <section className='statistics'>
      <ul className='statistics__list'>
        <VisibilitySensor onChange={handleVisibilityChange} partialVisibility>
          <li className='statistics__list-item'>
            <h3 className='statistics__count'>{counts.positions}</h3>
            <p className='statistics__description'>Различных позиций</p>
          </li>
        </VisibilitySensor>
        <VisibilitySensor onChange={handleVisibilityChange} partialVisibility>
          <li className='statistics__list-item'>
            <h3 className='statistics__count'>{"> " + counts.orders}</h3>
            <p className='statistics__description'>Сделанных заказов</p>
          </li>
        </VisibilitySensor>
        <VisibilitySensor onChange={handleVisibilityChange} partialVisibility>
          <li className='statistics__list-item'>
            <h3 className='statistics__count'>{counts.clients}</h3>
            <p className='statistics__description'>Довольных клиентов</p>
          </li>
        </VisibilitySensor>
      </ul>
      <img src={photo} alt="Фото еды" className='statistics__background'></img>
    </section>
  );
}

export default Statistics;
